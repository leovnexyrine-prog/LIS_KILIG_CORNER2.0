<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ðŸŒ¸ LIS Kilig Corner â€“ Flappy Bouquet</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>
  body{margin:0;font-family:sans-serif;background:#ffeef7;text-align:center;}
  h1{color:#d63384;margin-top:20px;}
  .card{background:white;max-width:420px;margin:20px auto;padding:20px;border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,0.1);}
  input,textarea,button{width:90%;padding:10px;margin:8px 0;border-radius:12px;border:1px solid #ccc;}
  textarea{resize:vertical;}
  button{background:#ff85b3;color:white;border:none;cursor:pointer;font-weight:bold;transition:.2s;}
  button:hover{background:#ff6399;}
  button:active{box-shadow:0 0 15px #ff85b3;transform:scale(.97);}
  .flowers{display:flex;flex-wrap:wrap;justify-content:center;gap:10px;}
  .flower-btn{background:#ffd6e8;border:2px solid #ff85b3;padding:10px 18px;border-radius:12px;cursor:pointer;}
  .flower-btn.selected{background:#ff85b3;color:white;box-shadow:0 0 12px #ff85b3;}
  #qrGate{margin-top:12px;}
  canvas{background:#b3e6ff;border-radius:12px;display:none;margin:20px auto;}
  #reveal{display:none;margin-top:10px;}
</style>
</head>
<body>
<h1>ðŸŒ¸ LIS Kilig Corner ðŸŒ¸</h1>

<div id="setup" class="card">
  <input id="receiver" placeholder="Recipient's Name ðŸ’Œ">
  <textarea id="message" placeholder="Your Message âœ¨"></textarea>
  <p><strong>Choose a Flower:</strong></p>
  <div class="flowers">
    <button class="flower-btn" data-f="ðŸŒ· Tulip">ðŸŒ· Tulip</button>
    <button class="flower-btn" data-f="ðŸŒ¹ Rose">ðŸŒ¹ Rose</button>
    <button class="flower-btn" data-f="ðŸŒ» Sunflower">ðŸŒ» Sunflower</button>
    <button class="flower-btn" data-f="ðŸŒ¼ Daisy">ðŸŒ¼ Daisy</button>
  </div>
  <button id="genQR">ðŸ”‘ Generate QR to Unlock Game</button>
  <div id="qrGate"></div>
</div>

<canvas id="game" width="360" height="480"></canvas>
<button id="reveal" class="card">ðŸ’Œ Reveal Bouquet</button>

<div id="view" class="card" style="display:none;">
  <h2>ðŸ’Œ Bouquet for <span id="viewName"></span></h2>
  <div style="font-size:3rem" id="viewFlower"></div>
  <p id="viewMsg"></p>
  <div id="link"></div>
  <div id="qr"></div>
</div>

<script>
let flower="",token="";
document.querySelectorAll(".flower-btn").forEach(b=>{
  b.onclick=()=>{document.querySelectorAll(".flower-btn").forEach(x=>x.classList.remove("selected"));b.classList.add("selected");flower=b.dataset.f;}
});

document.getElementById("genQR").onclick=()=>{
  if(!flower){alert("Pick a flower first ðŸŒ¸");return;}
  token=Math.random().toString(36).substr(2,5).toUpperCase();
  const gate=document.getElementById("qrGate");
  gate.innerHTML="<p>Scan this QR then type the 5-character code it shows to unlock:</p>";
  gate.innerHTML+="<p style='font-weight:bold;font-size:1.4rem'>"+token+"</p>";
  const q=document.createElement("div");gate.appendChild(q);
  new QRCode(q,{text:"KiligToken:"+token,width:200,height:200});
  setTimeout(()=>{
    const attempt=prompt("Enter the 5-character code after scanning:");
    if(attempt===token){document.getElementById("setup").style.display="none";startGame();}
    else alert("Wrong code. Generate again.");
  },500);
};

/* -------- Flappy Bird -------- */
const cvs=document.getElementById("game"),ctx=cvs.getContext("2d");
let bird={x:50,y:150,w:34,h:24,gravity:0.25,vel:0,lift:-4};
let pipes=[],frame=0,score=0,alive=true;

function startGame(){
  cvs.style.display="block";
  document.getElementById("reveal").style.display="inline-block";
  pipes=[];score=0;alive=true;
  bird.y=150;bird.vel=0;
  requestAnimationFrame(draw);
}
function draw(){
  ctx.fillStyle="#b3e6ff";ctx.fillRect(0,0,cvs.width,cvs.height);
  // Bird
  bird.vel+=bird.gravity;bird.y+=bird.vel;
  ctx.fillStyle="#ff85b3";ctx.beginPath();
  ctx.arc(bird.x,bird.y,12,0,Math.PI*2);ctx.fill();
  ctx.fillStyle="#fff";ctx.fillRect(bird.x+5,bird.y-3,6,6);
  // Pipes
  if(frame%90===0){
    const top=Math.random()*200+50;
    pipes.push({x:cvs.width,w:50,top:top,gap:100});
  }
  for(let i=0;i<pipes.length;i++){
    let p=pipes[i];
    p.x-=2;
    ctx.font="28px sans-serif";ctx.textAlign="center";
    for(let y=0;y<p.top;y+=28)ctx.fillText(flower.split(" ")[0],p.x+25,y+20);
    for(let y=p.top+p.gap;y<cvs.height;y+=28)ctx.fillText(flower.split(" ")[0],p.x+25,y);
    // collision
    if(bird.x+12>p.x&&bird.x-12<p.x+p.w&&(bird.y-12<p.top||bird.y+12>p.top+p.gap)) alive=false;
    if(p.x+p.w<bird.x&&!p.passed){score++;p.passed=true;}
  }
  pipes=pipes.filter(p=>p.x>-60);
  if(bird.y+12>cvs.height||bird.y-12<0) alive=false;
  ctx.fillStyle="#d63384";ctx.font="20px sans-serif";ctx.fillText("Score: "+score,60,30);
  if(alive){frame++;requestAnimationFrame(draw);}
  else ctx.fillText("Game Over ðŸ’” (Press space/click to restart)",cvs.width/2,cvs.height/2);
}
function flap(){if(alive)bird.vel=bird.lift;else startGame();}
cvs.addEventListener("mousedown",flap);
window.addEventListener("keydown",e=>{if(e.code==="Space")flap();});

/* -------- Reveal Bouquet -------- */
document.getElementById("reveal").onclick=()=>{
  const r=document.getElementById("receiver").value.trim()||"Recipient";
  const m=document.getElementById("message").value.trim()||"(No message)";
  const payload=encodeURIComponent(JSON.stringify({receiver:r,message:m,flower:flower}));
  const url=window.location.origin+window.location.pathname+"?data="+payload;
  document.getElementById("view").style.display="block";
  document.getElementById("viewName").innerText=r;
  document.getElementById("viewFlower").innerText=flower.split(" ")[0];
  document.getElementById("viewMsg").innerText=m;
  document.getElementById("link").innerHTML=`<p>Shareable link:</p><a href="${url}" target="_blank">${url}</a>`;
  new QRCode(document.getElementById("qr"),{text:url,width:200,height:200});
};

/* -------- Auto bouquet view if link visited -------- */
(function(){
  const params=new URLSearchParams(location.search);
  if(params.has("data")){
    try{
      const o=JSON.parse(decodeURIComponent(params.get("data")));
      document.getElementById("setup").style.display="none";
      document.getElementById("game").style.display="none";
      document.getElementById("reveal").style.display="none";
      document.getElementById("view").style.display="block";
      document.getElementById("viewName").innerText=o.receiver;
      document.getElementById("viewFlower").innerText=o.flower.split(" ")[0];
      document.getElementById("viewMsg").innerText=o.message;
    }catch(e){}
  }
})();
</script>
</body>
</html>
