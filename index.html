<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>🌸 LIS Kilig Corner 🌸</title>

<!-- QR Code Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
  body{font-family:sans-serif;text-align:center;padding:20px;background:#fff0f5;}
  h1{color:#d63384;}
  .card{background:#fff;padding:20px;border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,.1);max-width:420px;margin:20px auto;}
  input,textarea,button{width:90%;padding:10px;margin:8px 0;border-radius:12px;border:1px solid #ccc;}
  button.main{background:#ff85b3;color:#fff;border:none;font-weight:bold;cursor:pointer;transition:.3s;}
  button.main:hover{background:#ff6399;}
  .flowers{display:flex;justify-content:center;flex-wrap:wrap;gap:10px;margin:10px 0;}
  .flower-btn{background:#ffd6e8;border:2px solid #ff85b3;padding:10px 20px;border-radius:12px;cursor:pointer;transition:.3s;}
  .flower-btn.selected{background:#ff85b3;color:#fff;box-shadow:0 0 15px #ff85b3;}
  #qr{margin-top:15px;}

  /* Game overlay */
  #gameOverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:1000;
               align-items:center;justify-content:center;padding:20px;}
  #gameCard{background:#fff;border-radius:16px;padding:10px;box-shadow:0 8px 32px rgba(0,0,0,.4);
            max-width:760px;width:100%;}
  #gameCanvas{width:100%;height:430px;display:block;background:linear-gradient(#9fe8ff,#b3ffea);
              border-radius:12px;touch-action:none;}
  #gameInfo{display:flex;justify-content:space-between;margin-top:8px;}
  #finishNotice{display:none;padding:12px;border-radius:12px;background:#fff3f8;margin-top:8px;
                color:#8a1f4b;font-weight:bold;}
</style>
</head>
<body>
<h1>🌸 LIS Kilig Corner 🌸</h1>

<!-- Creator view -->
<div id="create" class="card">
  <input id="receiver" placeholder="Recipient's Name 💌">
  <textarea id="message" placeholder="Your Message ✨"></textarea>

  <p><strong>Choose a Flower:</strong></p>
  <div class="flowers">
    <button class="flower-btn" data-flower="🌷 Tulip">🌷 Tulip</button>
    <button class="flower-btn" data-flower="🌹 Rose">🌹 Rose</button>
    <button class="flower-btn" data-flower="🌻 Sunflower">🌻 Sunflower</button>
    <button class="flower-btn" data-flower="🌼 Daisy">🌼 Daisy</button>
  </div>

  <button class="main" onclick="makeLink()">💌 Generate Bouquet Link + QR</button>
  <div id="link"></div>
  <div id="qr"></div>
</div>

<!-- Receiver view (revealed after game) -->
<div id="view" class="card" style="display:none;">
  <h2>💌 Bouquet for <span id="viewName"></span></h2>
  <div style="font-size:3rem" id="viewFlower"></div>
  <p id="viewMsg"></p>
</div>

<!-- Game overlay -->
<div id="gameOverlay">
  <div id="gameCard">
    <canvas id="gameCanvas" width="760" height="430"></canvas>
    <div id="gameInfo">
      <div>Score: <span id="score">0</span></div>
      <button onclick="restartGame()">Restart</button>
    </div>
    <div id="finishNotice">🎉 You won! The bouquet will now appear.</div>
  </div>
</div>

<script>
/* ---------- CONFIG ---------- */
const SITE_BASE = "https://USERNAME.github.io/REPO"; // ← EDIT THIS
const TARGET_SCORE = 10; // points needed to unlock bouquet
/* ----------------------------- */

let selectedFlower = "";
document.querySelectorAll(".flower-btn").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".flower-btn").forEach(b=>b.classList.remove("selected"));
    btn.classList.add("selected");
    selectedFlower = btn.dataset.flower;
  });
});

function makeLink(){
  const receiver = receiverEl.value.trim() || "Recipient";
  const message  = messageEl.value.trim()  || "(No message)";
  if(!selectedFlower){alert("Please select a flower 🌸");return;}
  const payload = encodeURIComponent(JSON.stringify({receiver,message,flower:selectedFlower}));
  const url = `${SITE_BASE}/?data=${payload}`;
  linkEl.innerHTML = `<p>Share this link:</p><a href="${url}" target="_blank">${url}</a>`;
  qrEl.innerHTML = "";
  new QRCode(qrEl,{text:url,width:220,height:220});
}

const params = new URLSearchParams(window.location.search);
if(params.has("data")){
  try{
    const obj = JSON.parse(decodeURIComponent(params.get("data")));
    window.__bouquetData = obj;
    startGame(obj.flower);
  }catch(e){console.error(e);}
}

function revealBouquet(){
  createEl.style.display="none";
  viewEl.style.display="block";
  viewName.textContent = window.__bouquetData.receiver;
  viewFlower.textContent = window.__bouquetData.flower.split(" ")[0];
  viewMsg.textContent = window.__bouquetData.message;
}

/* ---------- DOM references ---------- */
const receiverEl = document.getElementById("receiver");
const messageEl  = document.getElementById("message");
const linkEl     = document.getElementById("link");
const qrEl       = document.getElementById("qr");
const createEl   = document.getElementById("create");
const viewEl     = document.getElementById("view");
const viewName   = document.getElementById("viewName");
const viewFlower = document.getElementById("viewFlower");
const viewMsg    = document.getElementById("viewMsg");
const gameOverlay= document.getElementById("gameOverlay");
const gameCanvas = document.getElementById("gameCanvas");
const scoreEl    = document.getElementById("score");
const finishNote = document.getElementById("finishNotice");

/* ---------- Flappy Game ---------- */
let ctx, bird, pipes, frame, loop, flowerEmoji="🌷";

function startGame(flower){
  flowerEmoji = flower.split(" ")[0];
  gameOverlay.style.display="flex";
  ctx = gameCanvas.getContext("2d");
  resetGame();
  window.addEventListener("keydown", flapKey);
  gameCanvas.addEventListener("mousedown", flap);
  loop = setInterval(update, 1000/60);
}

function resetGame(){
  bird = {x:120,y:215,vy:0,w:28,h:20,gravity:0.6,lift:-10};
  pipes=[]; frame=0; scoreEl.textContent="0";
  spawnPipe(120);
}

function flap(){ bird.vy = bird.lift; }
function flapKey(e){ if(e.code==="Space"||e.code==="ArrowUp"){e.preventDefault();flap();} }

function spawnPipe(offset=0){
  const gap=120,min=60,max=430-60-gap;
  const top=Math.floor(Math.random()*(max-min+1)+min);
  pipes.push({x:760+offset,top,gap,passed:false});
}

function update(){
  frame++;
  bird.vy += bird.gravity;
  bird.y  += bird.vy;

  if(bird.y<0 || bird.y+bird.h>430){ gameOver(); return; }

  for(let i=pipes.length-1;i>=0;i--){
    const p=pipes[i];
    p.x -= 2.6;
    if(p.x<-60) pipes.splice(i,1);
    else{
      if(pipes.length<4 && frame%90===0) spawnPipe();
      if(!p.passed && p.x+40<bird.x){ p.passed=true; score(); }
      if(hit(bird,p)){ gameOver(); return; }
    }
  }

  draw();
}

function score(){
  const s = +scoreEl.textContent + 1;
  scoreEl.textContent = s;
  if(s >= TARGET_SCORE) win();
}

function hit(b,p){
  return rect(b.x,b.y,b.w,b.h,p.x,0,50,p.top) ||
         rect(b.x,b.y,b.w,b.h,p.x,p.top+p.gap,50,430-(p.top+p.gap));
}
function rect(x1,y1,w1,h1,x2,y2,w2,h2){
  return !(x2>x1+w1 || x2+w2<x1 || y2>y1+h1 || y2+h2<y1);
}

function draw(){
  ctx.clearRect(0,0,760,430);
  ctx.fillStyle="#aef";
  ctx.fillRect(0,0,760,430);
  drawPipes();
  drawBird();
}
function drawBird(){
  ctx.save();
  ctx.translate(bird.x,bird.y);
  ctx.fillStyle="#ff82b3";
  ctx.beginPath();ctx.ellipse(0,0,18,14,0,0,2*Math.PI);ctx.fill();
  ctx.fillStyle="#ffd1e6";
  ctx.beginPath();ctx.ellipse(-2,2,8,5,0,0,2*Math.PI);ctx.fill();
  ctx.restore();
}
function drawPipes(){
  ctx.font="28px serif";ctx.textAlign="center";
  pipes.forEach(p=>{
    ctx.fillStyle="#7fbf7f33";
    ctx.fillRect(p.x,0,50,p.top);
    ctx.fillRect(p.x,p.top+p.gap,50,430-(p.top+p.gap));
    const topCount=Math.floor(p.top/30);
    for(let j=0;j<topCount;j++) ctx.fillText(flowerEmoji,p.x+25,18+j*30);
    const bStart=p.top+p.gap;
    const bCount=Math.floor((430-bStart)/30);
    for(let j=0;j<bCount;j++) ctx.fillText(flowerEmoji,p.x+25,bStart+18+j*30);
  });
}

function gameOver(){
  stopGame();
  alert("💥 Oops! Try again to unlock the bouquet.");
}

function win(){
  stopGame();
  finishNote.style.display="block";
  setTimeout(()=>{gameOverlay.style.display="none";revealBouquet();},800);
}

function stopGame(){
  clearInterval(loop);
  window.removeEventListener("keydown", flapKey);
  gameCanvas.removeEventListener("mousedown", flap);
}

function restartGame(){
  stopGame();
  finishNote.style.display="none";
  resetGame();
  window.addEventListener("keydown", flapKey);
  gameCanvas.addEventListener("mousedown", flap);
  loop = setInterval(update, 1000/60);
}
</script>
</body>
</html>
